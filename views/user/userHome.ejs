<%- include('./partials/header') %>

<!--=========== HOME CONTAINER ==========-->
<% const bgImage = content && content.image ? content.image :
'/images/default-background.jpg'; %>
<div
  class="home-container home-background"
  style="
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    background-image: url('<%= bgImage %>');
  "
>
  <div id="hero-main">
    <div class="hero-content">
      <div class="text-align">
        <div class="container">
          <div class="row">
            <div class="col-12 col-md-12 col-lg-12 col-xl-12">
              <h1 id="welcome">
                <%= content && content.caption ? content.caption : "Welcome To KOSHER LIVINGS HOLIDAY" %>
              </h1>
              <h3 id="tagline">
                <%= content&&content.tagline? content.tagline: "Enjoy your Life with us" %>
              </h3>

              <div class="hero-text">
                <form>
                  <div class="row">
                    <div class="col-lg-12 availability-col">
                      <div class="col-12 col-md-6 col-lg-3 col-xl-3">
                        <div class="form-group">
                          <input
                            type="date"
                            class="form-control dpd1"
                            placeholder="Arrival Date"
                            id="arrival"
                            required
                          />
                        </div>
                      </div>
                      <!-- end columns -->

                      <div class="col-12 col-md-6 col-lg-3 col-xl-3">
                        <div class="form-group">
                          <input
                            type="date"
                            class="form-control dpd1"
                            placeholder="Departure Date"
                            id="departure"
                            required
                          />
                        </div>
                      </div>
                      <!-- end columns -->
                       
                      <div class="col-12 col-md-6 col-lg-3 col-xl-3">
                        <div class="form-group">
                          <span><i class="fa fa-angle-down"></i></span>
                          <select class="form-control" id="roomId" required>
                            <% rooms.forEach(room => { %>
                            <option value="<%= room._id %>">
                              <%= room.roomType %>
                            </option>
                            <% }) %>
                          </select>
                        </div>
                      </div>
                      <!-- end columns -->

                      <div class="col-12 col-md-6 col-lg-3 col-xl-3">
                        <div class="form-group">
                          <span><i class="fa fa-angle-down"></i></span>
                          <select class="form-control" id="adults">
                            <option selected>Adults</option>
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                          </select>
                        </div>
                      </div>
                      <!-- end columns -->

                      <div class="col-12 col-md-6 col-lg-3 col-xl-3">
                        <div class="form-group">
                          <span><i class="fa fa-angle-down"></i></span>
                          <select class="form-control" id="children">
                            <option selected>Children</option>
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                          </select>
                        </div>
                      </div>
                      <!-- end columns -->

                    </div>
                    <div
                      class="col-12 col-md-12 col-lg-12 col-xl-12 text-center"
                    >
                      <div
                        class="btn btn-default btn-lg btn-padding"
                        id="availability-btn"
                        onclick="availability()"
                      >
                        Check Availability
                      </div>
                    </div>
                    <!-- end columns -->
                  </div>
                  <!-- end row -->
                </form>
              </div>
              <!-- end hero text -->
            </div>
            <!-- end col-md-12 -->
          </div>
          <!-- end row -->
        </div>
        <!-- end container -->
      </div>
      <!-- end text align -->
    </div>
    <!-- end hero content -->
  </div>
  <!-- end hero main -->
</div>
<!-- end home-container -->

<style>
  /* Style form inputs */
  .form-control {
    background-color: white !important; /* White background */
    color: #04454D !important; /* Black text */
  }

</style>

<!--=============== ABOUT ===============-->
<section id="about">
  <div class="container">
    <div class="row" id="about-img">
      <div class="col-12 col-md-6 col-lg-6 col-xl-6" id="about-text">
        <h2>About Kosher</h2>
        <p>
          Kosher Livings in Kalpetta, Wayanad offers premium PG/guest house
          accommodations with a variety of flexible options, including single,
          double, and shared occupancies. With excellent amenities, convenient
          locations, and affordable rents, they ensure a pleasant and secure
          stay for all guests.
        </p>
        <p>
          At Kosher Livings, guests are provided with a secure and welcoming
          environment featuring modern amenities and personalized services.
          Offering flexible living arrangements, Kosher Livings ensures that
          every guest finds the perfect fit for their needs. The PG/guest house
          caters to different accommodation preferences. Book your space today
          and experience a perfect blend of comfort and value.
        </p>

        <a href="/about" class="btn btn-lg btn-padding">View More</a>
      </div>
      <!-- end columns -->

      <div class="col-12 col-md-6 col-lg-6 col-xl-6"></div>
      <!-- end columns -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>
<!-- end about -->

<!--================ SERVICES ==============-->
<section id="services" class="section-padding">
  <div class="container">
    <div class="row">
      <div class="col-12 col-md-12 col-lg-12 col-xl-12">
        <div class="page-heading">
          <h2>Our <span style="color: #04454D">Awesome Services</span></h2>
          <p>
            To provide a comfortable stay, Kosher Livings offers a range of
            amenities, including:
          </p>
        </div>
        <!-- end page-heading -->

        <div id="service-blocks">
          <div class="row">
            <div class="col-12 col-md-6 col-lg-4 col-xl-4">
              <div class="service-block">
                <span><i class="fa fa-wifi"></i></span>
                <h2 class="service-name">Free Wifi</h2>
                <p>Stay seamlessly connected throughout your visit with our high-speed WiFi, available across the entire property, ensuring you can browse, stream, and work effortlessly whenever you need.</p>
              </div>
              <!-- end service-block -->
            </div>
            <!-- end columns -->
            <div class="col-12 col-md-6 col-lg-4 col-xl-4">
              <div class="service-block">
                <span><i class="fa fa-tint"></i></span>
                <h2 class="service-name">Pool</h2>
                <p>Take a refreshing dip in our luxurious pool, where crystal-clear waters invite you to unwind, whether you're enjoying a leisurely swim or simply basking in the sun by the poolside.</p>
              </div>
              <!-- end service-block -->
            </div>
            <!-- end columns -->

            <div class="col-12 col-md-6 col-lg-4 col-xl-4">
              <div class="service-block">
                <span><i class="fa fa-music"></i></span>
                <h2 class="service-name">DJ</h2>
                <p>Enjoy electrifying beats and a lively atmosphere with our in-house DJ to keep the party going and create unforgettable moments during your stay.</p>
              </div>
              <!-- end service-block -->
            </div>
            <!-- end columns -->

            
          </div>
          <!-- end row -->
        </div>
        <!-- end service-blocks -->

        <div class="butn text-center">
          <a href="/services" class="btn btn-lg btn-padding btn-g-border"
            >More Services</a
          >
        </div>
        <!-- end butn -->
      </div>
      <!-- end columns -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>
<!-- end services -->

<!--===================== PHOTO-GALLERY ===================-->
<section id="photo-gallery" class="section-padding no-pd-top">
  <div class="container">
    <div class="row">
      <div class="col-12 col-md-12 col-lg-12 col-xl-12">
        <div class="page-heading">
          <h2>Picture <span style="color: #04454D">Gallery</span></h2>
          <p>
            Explore our stunning photo gallery showcasing beautiful moments,
            breathtaking views, and unforgettable experiences. Each picture
            tells a story, inviting you to be a part of our journey.
          </p>
        </div>
        <!-- end page-heading -->
      </div>
      <!-- end columns -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->

  <div class="container-fluid">
    <div class="row justify-content-center d-flex flex-column">
      <div id="gallery" class="mx-auto">
        <% if (galleries.length > 0) { %> <% galleries.forEach(image => { %>
        <div class="gallery-product col-12 col-md-6 col-lg-3 col-xl-3 p-1">
          <a
            href="<%= image.image %>"
            class="with-caption gallery image-link justify-content-center"
          >
            <div
              class="gallery-block mx-auto"
              style="
                height: 350px;
                width: 350px;
                background-image: url(<%= image.image %>);
                background-size: cover;
                background-position: center center;
                background-repeat: no-repeat;
              "
            ></div>
          </a>
        </div>
        <% }) %> <% } else { %>
        <p class="text-center">No images available in the gallery.</p>
        <% } %>
      </div>
      <!-- end gallery -->
      <div class="butn text-center" style="margin: auto">
        <a href="/gallery" class="btn btn-lg btn-padding btn-g-border"
          >More Images</a
        >
      </div>
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>
<!-- end gallery -->

<!--=============== TESTIMONIALS ==============-->
<section id="testimonials" class="banner-padding">
  <div class="container">
    <div class="row">
      <div class="col-12 col-md-12 col-lg-12 col-xl-12">
        <div class="carousel slide review-carousel" data-ride="carousel">
          <div class="row">
            <!-- Carousel Indicators -->
            <div class="col-3 col-md-1 col-lg-1 col-xl-1">
              <ol class="carousel-indicators" style="top: 110px">
                <% recentReviews.forEach((_, index) => { %>
                <li
                  data-target=".review-carousel"
                  data-slide-to="<%= index %>"
                  class="<%= index === 0 ? 'active' : '' %>"
                ></li>
                <% }); %>
              </ol>
            </div>
            <!-- end columns -->

            <div class="col-12 col-md-11 col-lg-11 col-xl-11">
              <div class="row">
                <div
                  class="col-12 offset-md-4 col-md-8 offset-lg-3 col-lg-7 offset-xl-3 col-xl-7"
                >
                  <h2 style="color: #fff;">What People Say About Us</h2>
                </div>
              </div>
              <!-- end row -->

              <!-- Overall Ratings -->
              <div class="overall-rating">
                <% if(recentReviews.length>0){ %>
                  <h4 style="color: white; margin-top: 10px"> 
                  ⭐ <%= averageRatings.avgOverallRating.toFixed(1) %>/5 – <%=
                  averageRatings.avgOverallRating >= 4.5 ? 'Excellent' :
                  averageRatings.avgOverallRating >= 4 ? 'Very Good' : 'Good' %>
                </h4>
                <% } %> 
                
              </div>

              <!-- Carousel Inner -->
              <div class="carousel-inner">
                <% recentReviews.forEach((review, index) => { %>
                <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                  <div class="row">
                    <!-- Reviewer Image -->
                    <div
                      class="col-12 col-md-4 col-lg-3 col-xl-3 reviewer-image"
                    >
                      <img
                        src="<%= review.profileImage ? review.profileImage: '/images/default-reviewer.jpg' %>"
                        alt="reviewer-image"
                        class="rounded-circle"
                      />
                    </div>

                    <!-- Reviewer Content -->
                    <div class="col-12 col-md-8 col-lg-9 col-xl-9">
                      <p class="review-text"><%= review.review %></p>

                      <!-- Rating Stars -->
                      <div class="rating">
                        <% for (let i = 1; i <= 5; i++) { %>
                        <span>
                          <i
                            class="fa fa-star <%= i <= review.overallRating ? '' : 'star-opacity' %>"
                          ></i>
                        </span>
                        <% } %>
                      </div>

                      <p class="reviewer-name"><%= review.name %></p>
                    </div>
                  </div>
                </div>
                <% }); %>
              </div>
              <!-- end carousel-inner -->

              <!-- Review & Ratings Buttons -->
              <div class="review">
                <div class="butn text-center" style="margin: auto">
                  <a
                    href="/reviews"
                    class="btn btn-lg btn-padding btn-g-border review-btn"
                  >
                    Write a Review
                  </a>
                </div>
                <div class="butn text-center" style="margin: auto">
                  <a
                    href="/ratings"
                    class="btn btn-lg btn-padding btn-g-border review-btn"
                  >
                    Ratings & Reviews
                  </a>
                </div>
              </div>
            </div>
            <!-- end columns -->
          </div>
          <!-- end row -->
        </div>
        <!-- end review-carousel -->
      </div>
      <!-- end columns -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>
<!-- end testimonials -->

<%- include('./partials/footer') %>

<!-- Page Scripts Ends
<script>
  $("#datepicker").datepicker({
    uiLibrary: "bootstrap4",
  });
  $("#datepicker1").datepicker({
    uiLibrary: "bootstrap4",
    
  });
</script> -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const today = new Date().toISOString().split("T")[0];

    const arrivalInput = document.getElementById("arrival");
    const departureInput = document.getElementById("departure");

    // Set minimum date for both arrival and departure to today
    arrivalInput.setAttribute("min", today);
    departureInput.setAttribute("min", today);

    arrivalInput.addEventListener("change", function () {
      // Ensure departure date cannot be before arrival date
      departureInput.setAttribute("min", arrivalInput.value);
      if (departureInput.value < arrivalInput.value) {
        departureInput.value = arrivalInput.value;
      }
    });
  });
</script>

<script>
  async function availability() {
    const data = {
      arrival: document.getElementById("arrival").value,
      departure: document.getElementById("departure").value,
      roomId: document.getElementById("roomId").value,
      adults: document.getElementById("adults").value,
      children: document.getElementById("children").value,
    };

    const button = document.getElementById("availability-btn");
    const roomData =
      document.getElementById("roomId").options[
        document.getElementById("roomId").selectedIndex
      ].text;

    if (!data.arrival || !data.departure || !data.roomId) {
      Swal.fire({
        icon: "warning",
        title: "Incomplete Information",
        text: "Please select your room type, check-in, and check-out dates.",
      });
      return;
    }

    try {
      const response = await fetch("/availability", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (result?.available === true) {
        Swal.fire({
          icon: "success",
          title: "Room Available!",
          text: result?.message,
          confirmButtonText: "Proceed to Book",
        }).then(() => {
          const roomData = encodeURIComponent(JSON.stringify(result.room));
          // Update button to "Book Now" and redirect to reservation page
          button.textContent = "Book Now";
          button.onclick = function () {
            window.location.href = `/reservation?arrival=${
              data.arrival
            }&departure=${data.departure}&adults=${data.adults}&children=${
              data.children
            }&room=${encodeURIComponent(roomData)}`;
          };
        });
      } else {
        Swal.fire({
          icon: "error",
          title: "Room Not Available",
          text: result?.message,
        });
        // Reset to "Check Availability"
        button.textContent = "Check Availability";
        button.onclick = availability;
      }
    } catch (error) {
      console.error("Error during availability check:", error);
      Swal.fire({
        icon: "error",
        title: "Error",
        text: "An error occurred while checking room availability.",
      });
    }
  }
</script>

<style>
  .overall-rating {
    text-align: center;
    margin-bottom: 30px;
  }

  .rating span {
    color: gold;
  }

  .reviewer-image img {
    max-width: 180px;
    height: 180px;
  }

  .carousel-inner {
    margin-top: 20px;
  }

  .btn-g-border {
    border: 2px solid #28a745;
    color: #28a745;
    margin: 0 10px;
  }

  .btn-g-border:hover {
    background-color: #28a745;
    color: #fff;
  }

  .availability-col {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  @media screen and (max-width: 1000px) {
    .review {
      display: block;
    }
  }
  @media screen and (min-width: 1000px) {
    .review {
      display: flex;
    }
  }
</style>
